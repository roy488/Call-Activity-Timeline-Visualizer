<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RingCentral Call Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body class="bg-gray-50 text-gray-900 min-h-screen">
  <div class="max-w-7xl mx-auto py-8 px-4">
    <h1 class="text-3xl font-bold mb-6 text-center">RingCentral Agent Call Dashboard</h1>

    <div id="upload-zone" class="border-4 border-dashed border-blue-400 bg-white p-10 rounded-2xl text-center hover:bg-blue-50 cursor-pointer">
      <p class="text-lg mb-4">ðŸ“„ Drag & drop your <strong>RingCentral XLSX</strong> file here</p>
      <p class="text-gray-500 mb-2">or</p>
      <input type="file" id="fileInput" accept=".xlsx" class="hidden" />
      <button id="fileSelect" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-md">Choose File</button>
    </div>

    <div id="loading" class="hidden text-center mt-6 text-blue-600 font-medium">Processing file...</div>

    <div id="results" class="mt-10 hidden">
      <h2 class="text-2xl font-semibold mb-4">ðŸ“Š Summary Table</h2>
      <div class="overflow-x-auto">
        <table class="min-w-full bg-white border border-gray-200 rounded-lg shadow-md">
          <thead class="bg-gray-100 border-b">
            <tr>
              <th class="py-3 px-4 text-left font-medium">Agent</th>
              <th class="py-3 px-4 text-left font-medium">Inbound</th>
              <th class="py-3 px-4 text-left font-medium">Inbound Time</th>
              <th class="py-3 px-4 text-left font-medium">Outbound</th>
              <th class="py-3 px-4 text-left font-medium">Outbound Time</th>
              <th class="py-3 px-4 text-left font-medium">Total</th>
              <th class="py-3 px-4 text-left font-medium">Total Time</th>
            </tr>
          </thead>
          <tbody id="summaryBody" class="divide-y divide-gray-200"></tbody>
        </table>
      </div>

      <h2 class="text-2xl font-semibold mt-10 mb-4">ðŸ“… Call Activity Timeline</h2>
      <div id="timeline" class="grid grid-cols-24 gap-1"></div>
    </div>
  </div>

  <script>
    const uploadZone = document.getElementById("upload-zone");
    const fileInput = document.getElementById("fileInput");
    const fileSelect = document.getElementById("fileSelect");
    const loading = document.getElementById("loading");
    const results = document.getElementById("results");
    const summaryBody = document.getElementById("summaryBody");

    const agentList = [
      "ALEJANDRO SATUNINO CAMPOS-PEREZ","AUSTIN MITCHELL","Brady Olson","Brandon Ridder",
      "BRANDON RUSSOM","BRENDAN BOH","Cullen Manley","David Ryan","DOMINIQUE GONZALES",
      "Duncan Cannon","Hayden Holcomb","Joel Jubber","John Udick","KIMBERLY RAMIREZ",
      "MARCOS HERNANDEZ","MOUNIR ROSENDO","Natasha Fowler","Nathan Hill","Olivia Kasten",
      "Tammy Lummus","Wanda Scott"
    ];
    const agentMap = {};
    agentList.forEach(a => agentMap[a.toUpperCase()] = a);

    function extractAgentName(name) {
      if (!name || typeof name !== "string") return null;
      let cleaned = name.split(" - ")[0].split("(")[0].trim().toUpperCase();
      for (const key in agentMap) {
        if (cleaned.includes(key) || key.includes(cleaned)) return agentMap[key];
      }
      const last = cleaned.split(" ").pop();
      for (const key in agentMap) {
        if (key.endsWith(last)) return agentMap[key];
      }
      return null;
    }

    function timeToSeconds(time) {
      if (typeof time === "number") return time;
      if (typeof time === "string") {
        const parts = time.split(":").map(Number);
        if (parts.length === 3) return parts[0]*3600 + parts[1]*60 + parts[2];
        if (parts.length === 2) return parts[0]*60 + parts[1];
      }
      return 0;
    }

    function formatSeconds(sec) {
      const h = Math.floor(sec / 3600);
      const m = Math.floor((sec % 3600) / 60);
      const s = sec % 60;
      return `${h}h ${m}m ${s}s`;
    }

    function processXLSX(data) {
      const workbook = XLSX.read(data, { type: "binary" });
      const sheet = workbook.Sheets["Calls"];
      if (!sheet) { alert("âŒ 'Calls' sheet not found."); return; }

      const rows = XLSX.utils.sheet_to_json(sheet);
      const summary = {};

      rows.forEach(r => {
        const from = extractAgentName(r["From Name"]);
        const to = extractAgentName(r["To Name"]);
        const agent = from || to;
        if (!agent) return;

        const direction = r["Call Direction"];
        const result = r["Result"];
        const length = timeToSeconds(r["Call Length"]);

        if (!summary[agent]) summary[agent] = { inbound:0,outbound:0,total:0,inboundSec:0,outboundSec:0,totalSec:0 };

        if (direction === "Inbound") {
          summary[agent].inbound++;
          summary[agent].inboundSec += length;
        } else if (direction === "Outbound") {
          summary[agent].outbound++;
          summary[agent].outboundSec += length;
        }
        summary[agent].total++;
        summary[agent].totalSec += length;
      });

      summaryBody.innerHTML = "";
      Object.keys(summary).sort((a,b)=>summary[b].total-summary[a].total).forEach(agent=>{
        const s = summary[agent];
        const row = document.createElement("tr");
        row.innerHTML = `
          <td class="py-2 px-4">${agent}</td>
          <td class="py-2 px-4">${s.inbound}</td>
          <td class="py-2 px-4">${formatSeconds(s.inboundSec)}</td>
          <td class="py-2 px-4">${s.outbound}</td>
          <td class="py-2 px-4">${formatSeconds(s.outboundSec)}</td>
          <td class="py-2 px-4 font-semibold">${s.total}</td>
          <td class="py-2 px-4 font-semibold">${formatSeconds(s.totalSec)}</td>`;
        summaryBody.appendChild(row);
      });

      results.classList.remove("hidden");
      loading.classList.add("hidden");
    }

    function handleFile(file) {
      loading.classList.remove("hidden");
      const reader = new FileReader();
      reader.onload = e => processXLSX(e.target.result);
      reader.readAsBinaryString(file);
    }

    fileSelect.onclick = () => fileInput.click();
    fileInput.onchange = e => handleFile(e.target.files[0]);
    uploadZone.ondragover = e => { e.preventDefault(); uploadZone.classList.add("bg-blue-100"); };
    uploadZone.ondragleave = e => uploadZone.classList.remove("bg-blue-100");
    uploadZone.ondrop = e => {
      e.preventDefault();
      uploadZone.classList.remove("bg-blue-100");
      const file = e.dataTransfer.files[0];
      if (file && file.name.endsWith(".xlsx")) handleFile(file);
      else alert("Please upload a valid XLSX file.");
    };
  </script>
</body>
</html>
11.11
